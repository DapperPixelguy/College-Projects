{% extends 'base.html' %}

{% block title %}
League Table
{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='league_table.css') }}">
{% endblock %}

{% block content %}

<table class="table">
    <thead class="header-row barlow-condensed">
        <tr>
            <th>Name</th>
            <th>Played</th>
            <th>Won</th>
            <th>Draw</th>
            <th>Lost</th>
            <th>Points For</th>
            <th>Points Against</th>
            <th>Points Difference</th>
            <th>Bonus Points</th>
            <th>Total Points</th>
        </tr>
    </thead>

    <tbody>
    {# Standings will be filled in here by js function #}
    </tbody>

</table>>

{% endblock %}

{% block script %}
<script>

async function loadTable () {
    const table_body = document.querySelector('tbody')

    table_body.innerHTML =`
     <tr class="loading">
        <td>Loading...</td>
        <td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
     </tr>
    `

    try {
        buildTable()
    } catch (error) {

    }

}

async function buildTable() {

    let response = await fetch('/league-table/fetch')
    let data = await response.json()
    const table = document.querySelector('tbody')
    table.innerHTML = ``
    let counter = 0

    data.forEach(team => {
        const entry = document.createElement('tr')
        const standing = team.standing
        let name = document.createElement('td')

        if (counter === 1) {
            entry.classList.add('alternate')
            counter --
        } else {
            counter ++
        }



        entry.classList.add('entry')
        name.innerHTML = team.name
        entry.appendChild(name)

        Object.entries(standing).forEach(([key, value]) => {
            let elem = document.createElement('td')
            elem.innerHTML = value
            entry.appendChild(elem)
        })
        table.appendChild(entry)
    })
}

document.addEventListener('DOMContentLoaded', loadTable)

</script>
{% endblock %}